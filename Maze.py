import pygame
from ImageRect import ImageRect

class Maze():
    RED = (255, 0, 0)
    BLACK = (0, 0, 0)
    BRICK_SIZE = 16
    POINT_SIZE = 9
    PILL_SIZE = 12
    NODE_SIZE = 12

    def __init__(self, pacSettings, screen, mazefile, brickfile, portalfile, shieldfile, pointfile, nodefile, mazeBound, barrierBound, points, nodes):#, pillfile):
        self.pacSettings = pacSettings
        self.screen = screen
        self.filename = mazefile
        self.nodefile = nodefile
        with open(self.filename, "r") as f:
            self.rows = f.readlines()
        self.brickfile = brickfile
        self.shieldfile = shieldfile
        self.pointfile = pointfile

        self.hportals = []
        self.vportals = []
        self.pill = []

        self.bsz = Maze.BRICK_SIZE
        self.psz = Maze.POINT_SIZE
        self.nsz = Maze.NODE_SIZE

        self.brick = ImageRect(screen, self.brickfile, self.bsz, self.bsz, 0, 0)
        self.deltax = self.deltay = Maze.BRICK_SIZE

        self.portal = ImageRect(screen, portalfile, self.bsz, self.bsz, 0, 0)
        self.sheld = ImageRect(screen, shieldfile, self.bsz, self.bsz, 0, 0)
        self.pts = ImageRect(screen, pointfile, self.psz, self.psz, 0, 0)
        self.nod = ImageRect(screen, nodefile, self.psz, self.psz, 0, 0)

        self.build(mazeBound, barrierBound, points, nodes)

    def build(self, mazeBound, barrierBound, points, nodes):
        r = self.brick.rect
        w, h = r.width, r.height
        self.dx, self.dy = self.deltax, self.deltay

        shield = self.sheld.rect
        sw, sh = shield.width, shield.height

        point = self.pts.rect
        pw, ph = point.width, point.height

        for nrow in range(len(self.rows)):
            row = self.rows[nrow]
            for ncol in range(len(row)):
                col = row[ncol]
                if col == "X":
                    # self.bricks.append(pygame.Rect(ncol * self.dx, nrow * self.dy, w, h))
                    self.brick2 = ImageRect(self.screen, self.brickfile, self.bsz, self.bsz, ncol * self.dx, nrow * self.dy)
                    mazeBound.add(self.brick2)
                elif col == "h":
                    self.hportals.append(pygame.Rect(ncol * self.dx, nrow * self.dy, w, h))
                elif col == "o":
                    # self.shields.append(pygame.Rect(ncol * self.dx, nrow * self.dy, sw, sh))
                    self.shield2 = ImageRect(self.screen, self.shieldfile, self.bsz, self.bsz, ncol * self.dx, nrow * self.dy)
                    barrierBound.add(self.shield2)
                elif col == "," or col == "N":
                    # self.points.append(pygame.Rect(ncol * self.dx, nrow * self.dy, pw, ph))
                    self.point = ImageRect(self.screen, self.pointfile, self.psz, self.psz, ncol * self.dx, nrow * self.dy)
                    points.add(self.point)
                elif col == "v":
                    self.vportals.append(pygame.Rect(ncol * self.dx, nrow * self.dy, w, h))

        for nrow in range(len(self.rows)):
            row = self.rows[nrow]
            for ncol in range(len(row)):
                col = row[ncol]
                if col == "N":
                    self.node = ImageRect(self.screen, self.nodefile, self.nsz, self.nsz, ncol * self.dx, nrow * self.dy)
                    nodes.add(self.node)

    def blitme(self, mazeBound, barrierBound, points, nodes):
        for node in nodes.sprites():
            self.screen.blit(self.nod.image, node)
        for pt in points.sprites():
            self.screen.blit(self.pts.image, pt)
        for rect in mazeBound.sprites():
            self.screen.blit(self.brick.image, rect)
        for hport in self.hportals:
            self.screen.blit(self.portal.image, hport)
        for shild in barrierBound.sprites():
            self.screen.blit(self.sheld.image, shild)
        for vport in self.vportals:
            self.screen.blit(self.portal.image, vport)
            
    def resetMaze(self, points):
        for nrow in range(len(self.rows)):
            row = self.rows[nrow]
            for ncol in range(len(row)):
                col = row[ncol]
                if col == "," or col == "N":
                    self.point = ImageRect(self.screen, self.pointfile, self.psz, self.psz, ncol * self.dx, nrow * self.dy)
                    points.add(self.point)